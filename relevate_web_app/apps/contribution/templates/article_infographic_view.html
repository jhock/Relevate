{% extends "base-titlebar.html" %}
{% load staticfiles %}

{% block head %}
	{{ block.super }}
	<script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=59d698fcf466510012f7fead&product=sticky-share-buttons"></script>
{% endblock %}

{% block content %}
<div class='uk-container uk-margin-top'>
	<div hidden id="error-message" class="uk-alert uk-alert-danger">
		<p>Sorry Something went wrong try again, or reload page</p>
	</div>
	 <div hidden id="publish-message" class="uk-alert uk-alert-success">
		<p>Article has been published!</p>
	</div>
	 <div hidden id="unpublish-message" class="uk-alert uk-alert-success">
		<p>Article has been unpublished!</p>
	</div>
	<div uk-grid>
		<div class="uk-width-1-2">
			<h4>Article Title: {{ infographic.title }}</h4>
		</div>
	</div>
	<br>

    <div class='uk-form-row'>
            <label class='uk-form-label uk-text-bold'>{{ form.blurb.label }} <span id="blurb_count"></span></label>
            <div class='uk-form-controls'>
                {{ form.blurb }}
            </div>
    </div>
    <br>
	{% if is_user_article %}
	<form method="post" action=".">{% csrf_token %}
		<div uk-grid>
			<div class="uk-width-1-3">
				{% if post.isPublished %}
					<button class="uk-button uk-button-primary" value="Make Live" type="submit" name="change_publish_false">Unpublish</button>
				{% else %}
					<button class="uk-button uk-button-success" value="Make Live" type="submit" name="change_publish_true">Make Live</button>
				{% endif %}
			</div>
			<div class="uk-width-1-3">
				<button class="uk-button uk-button-danger" onclick="confirmDeletion()">Remove</button>
			</div>
			<hr>
		</div>
	</form>
	{% endif %}
	<div class="uk-grid">
		<div class="uk-width-1-3">
			<h3>Views: {{ post.views }}</h3>
		</div>
		<div class="uk-width-1-3">
			<h3>Likes:  {{ post.likes }}</h3>
		</div>
	</div>
	{% with i=infographic %}
		{% with p=post %}
			{% include 'partials/infographic_partial.html' %}
		{% endwith %}
	{% endwith %}
	<br>

	<script>
		function confirmDeletion(){
			var message = "Are you sure you want to delete this infographic article?";
			if(confirm(message)){
				removeArticle();
			}
		}
		function removeArticle()
		{
			$.ajaxSetup({
				data: {csrfmiddlewaretoken: '{{ csrf_token }}'}
			});
			var slug_var = '{{ post.slug }}';
			$.ajax({
				url: '{% url 'contribution:post_remove' %}',
				type: "POST",
				data: { slug: slug_var },
				success: function(data)
				{
					var res_data = JSON.parse(data);
					if (res_data.deleted == true){
						window.location.replace("{% url 'contribution:all_posts' %}");
					}
					else{
						$("#error-message").show();
						console.log("something went wrong" + res_data.deleted);
					}
				},
				error: function(xhr)
				{
					// $("#error-message").text(xhr.responseText).show();
					$("#error-message").show();
					console.log("ERROR: " + xhr.responseText);
				}
			})
		}
	</script>
</div>
{% endblock %}